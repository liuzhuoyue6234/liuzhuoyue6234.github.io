---
title: "自动行驶小车(H 题)"  # 定义页面标题
date: 2026-1-20             # 发布日期
layout: post                 # 使用主题的“文章”布局（如果主题支持）
categories: [0, keil5]  # 分类
---
# 自动行驶小车(H 题)
![题目要求](assets/images/9187b07edca34322a2192830f28722c4.png)

自动行驶小车以 MSPM0G3507 为核心，搭载直流电机、电机驱动模块、JY-62 角度传感器、八路灰度循迹模块等共同构成一个闭环控制系统，设计并制作了可在指定路径行驶并完成声
光提示的自动行驶小车。

小车行驶路径可分为三部分:
- 直线行驶路段，系统运用速度环与角度环的并级 PID 控制算法，通过单片机向电机输出动态 PWM 波进而控制小车平稳直行；
- 半圆弧线行驶路段，采用灰度循迹模块检测黑线与小车相对位置，得出小车偏移量，利用小车电机转速差调整小车方向，进行黑线循迹；
- 半圆弧线端点交叉行驶路段，由 JY-62 获取小车偏向角后反馈至单片机，单片机自动矫正小车方向后，精准行驶至交叉端点。
---
## 小车自动行驶设计方案

![系统总体设计框图](assets/images/WPS图片(1).png)

**主控制器**：MSPM0G3507 是一款高性能微控制器，基于 ARM Cortex-M4 内核，最高运行频率为 120MHz，支持DSP指令和FPU。它配备了512KB的闪存和64KB的RAM，具有丰富的外设。因此MSPM0G3507完全满足设计需求。

**角度测量模块**：采用 JY-62 角度传感器。JY-62 是一款高性能的六轴倾角传感器，集成了陀螺仪、加速度计和磁力计，能够提供俯仰角、横滚角和航向角。JY-62 内置了融合算法，能够有效减少数据漂移，提高角度测量的准确性和稳定性。

  JY-62 角度传感器持续监测小车的转向角度，数据反馈至 MSPM0G3507。微控制器结合 PID算法调整 PWM 信号，实时矫正电机转速，确保小车在斜线交叉路径上的精准行驶。然而 JY-62在长时间运行中传感器的*零点漂移*，温度变化引起的读数偏差，以及传感器的非线性响应，都会导致角度测量不准确。为尽量减少 JY-62 对于小车行驶的误差，可进行*零点校正*,即在静态条件下进行初始角度校准,消除零点漂移。
  
  半圆弧线端点交叉行驶路段偏向角测量误差在进行手动校准斜线偏向角时，人体肉眼校准会产生一定误差，导致记录的斜线偏向角与实际偏向角出现随机偏差，最终无法完成任务，为解决肉眼误差，可在小车车头增加一个*红激光模块*，便于测量偏向角，减小了偏向角不同而产生的误差。
    
**寻迹模块**：采用八路灰度传感器。八路灰度传感器通过检测不同灰度级别的变化来识别路径，适用于复杂路径的跟踪，能够检测路径上的细微灰度差异，适用于各种颜色和纹理的路径。对环境光线变化的鲁棒性较强，即使在光线变化的环境中也能保持稳定检测。

八路灰度循迹模块实时检测路径偏移，数据经 MSPM0G3507 处理后，获取*左右电机转速差*，实现动态 PWM 输出，可进行稳定循迹。测试时可使用*标准灰度卡*进行标定，确保传感器在不同光照条件下的一致性。

**电机驱动模块**：采用 TB6612 电机驱动模块。TB6612 是一款高性能的双 H 桥电机驱动芯片，专为小型电机设计。其内部采用了先进的电路设计，减少了能量损耗，提高了驱动效率。

---
## 小车轨迹控制
 **1、白色场地轨迹控制**：自动行驶小车在白色场地需要走两种路线，半圆弧线相对端点直线路径以及交叉对应端点斜线路径：
 
*直线行驶路段*：小车进行半圆弧线相对端点路径自动行驶时，使用并级 PID 控制算法，由电机编码器与 MCU 交互进行速度环 PID 调节，增加小车左右电机速度稳定性，JY-62 角度传感器获取小车前进偏向角，反馈至单片机，当小车偏离直线，进行角度环 PID 调节，动态调整 PWM 波输出值，进而直线行驶。

*半圆弧线端点交叉行驶路段*：小车进行半圆弧线端点交叉路段自动行驶，利用 JY-62角度传感器记录斜线偏向角，上电后将小车姿态复位至零度，其次小车将转向至所记偏角方向，进行直线行驶，到达目标点。

**2、小车巡黑线控制**：小车进行半圆弧线自动行驶时，运用八路灰度循迹模块进行巡线，灰度模块调用八个 MCU的 GPIO 口，读取 I/O 口高低电平，判断识别到的黑线位置，运用电机速度差动态调整电机转速，改变小车行驶方向，实现循迹功能。

## 电路设计
*MSPM0G3507 最小系统板 *：MSPM0G3507 最小系统板围绕 ARM Cortex-M0+核心构建，集高性能与低功耗于一体。

*MSPM0G3507 电源电路*：TI MSPM0G3507 单片机为 3.3v 供电，外部供电模块为 12v 供电，首先降 5V，供各种外设使用，其次降至 3.3v，为 MCU 供电。

*MSPM0G3507 主要外设*：小车使用 TB6612 电机驱动模块输出两路 PWM 驱动左右电机；
                      JY-62 角度传感器由 3.3v供电，通过串口三与单片机进行小车姿态数据的传输；
                      八路灰度循迹模块为外接 I/O 口进行与单片机的通信。
    ---
## 程序设计与流程
**1、总体程序设计**：自动行驶小车将 MSPM0G3507 作为主控，运用 CCS Their 1.4.1 环境进行编译，搭载 JY-62角度传感器、灰度循迹模块等共同构成一个闭环控制系统，可在指定路径行驶并在半圆弧线端点进行声光提示。总体流程如图所示。

**2、PID算法**：在进行 PID 调参中，若比例 P、积分 I 和微分 D 参数的不当选择，可能会导致小车反应过快或过慢，甚至出现振荡。如果 PID 参数调整适当，当环境条件变化时，系统可能无法及时适应。可自适应 PID 控制，根据实时误差和系统响应调整参数。


